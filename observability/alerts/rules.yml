groups:
  - name: data-kata-alerts
    rules:
      - alert: HighKafkaConsumerLag
        expr: kafka_consumer_group_lag > 10000
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High consumer lag on {{ $labels.topic }}"
          description: "Consumer group {{ $labels.group }} has a lag of {{ $value }} on topic {{ $labels.topic }} partition {{ $labels.partition }}."

      - alert: FlinkCheckpointFailing
        expr: flink_jobmanager_job_lastCheckpointDuration > 60000
        for: 3m
        labels:
          severity: critical
        annotations:
          summary: "Flink checkpoint taking too long for {{ $labels.job_name }}"
          description: "Checkpoint duration is {{ $value }}ms for job {{ $labels.job_name }}."

      - alert: APILatencyHigh
        expr: histogram_quantile(0.95, rate(http_server_requests_seconds_bucket{job="results-api"}[5m])) > 2
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "API p95 latency exceeds 2 seconds"
          description: "The results API p95 latency is {{ $value }}s for endpoint {{ $labels.uri }}."
